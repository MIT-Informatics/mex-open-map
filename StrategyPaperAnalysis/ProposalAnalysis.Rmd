---
title: "Proposal Analysis"
output:
  pdf_document: default
  html_document:
    df_print: paged
  html_notebook: default
---

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////
Description: This notebook file was created by A. Trelles on 12/28/19 as part of the Strategy Paper. 
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////

#General Description:
This analysis is used as a reference to write the code for the analysis of partisan counterporposals for the 2013 and 2017 redistricting process in relation with partisan ruling status, its strenght (vote returns), and state level coalition dynamics.  

The first part of the ProposalAnalysis.Rmd IS NOT CODE. It describes the general objectives of the analysis based on the hypotheses derived from the paper and the available data we have to test them. In all cases, the DV is related to a partyÂ´s decision to formulate a counterporposal. 

General Hypotheses H1, H2, and H3 assume the DV is if a party formulated a counterporposal,
and vary according the ruling party (H1), party strenght/vote returns (H2), and coalitions (H3). 


// Setup //

#Libraries
```{r message=FALSE}
require(magrittr)
require(ggplot2)
require(dplyr)
require(tidyr)
require(readr)
require(haven)
require(fastDummies)
require(tidymodels)
require(tibble)
require(stringr)
require(purrr)
require(forcats)
require(gt)
require(rlang)
require(tidylog)
require(car)
require(lmtest)
require(ordinal)
require(readxl)
require(rcompanion)
```
# Build Database
## Build proposal event database: propfull.df
```{r message=FALSE}
# reads in Pre-Normalized IFE tables and produces proposals.df data
source("Normalize.R")
# integrates in plans from MxDistritos
## capture output because it is noisy and slows down interactive notebook
out<-capture.output(source("integrateMxdistritos.R"))
rm(proposals.df)
```
## Build Party Type Table
Major - PRD, PAN, PRI
Minor - PT, PVEM, ES, MORENA, MC, PNA
Admin - CLV, Algorithm, Junta, INE, derfe
Other - PRD51
```{r}
#Categorize types of parties
#break out into a separate data frame and save for future use

parties.df <- structure(list(actor = structure(c(2L, 7L, 9L, 10L, 11L, 13L, 
14L, 15L, 1L, 6L, 12L, 5L, 4L, 8L, 3L), .Label = c("Algorithm", 
"CLV", "derfe", "ES", "INE", "Junta", "MC", "MORENA", "PAN", 
"PNA", "PRD", "PRD51", "PRI", "PT", "PVEM"), class = "factor"), 
    partytype = structure(c(1L, 3L, 2L, 3L, 2L, 2L, 3L, 3L, 1L, 
    1L, 4L, 1L, 3L, 3L, 1L), .Label = c("admin", "major", "minor", 
    "other"), class = "factor")), class = "data.frame", row.names = c(NA, 
-15L))

propfull.df %<>% left_join(parties.df)
table(parties.df$partytype)
```

## Bring in ruling party db, 
```{r}
source("RulingParty_micah.R")

```
#Transparency Analysis
##Invalidations
```{r}
xtabs(PROPOSED~INVALID+year, propfull.df)
ftable(xtabs(PROPOSED~INVALID+edon+year, propfull.df))
ftable(xtabs(PROPOSED~INVALID+actor+year+stage, propfull.df))

```
Generate data frame for testing entry decisions.

Data frame: ys.proposed

Main unit of analysis: (party BY state AND year) -- summarize the actions each party took for each state in year -- NOT individual proposals

Measures (aggregated by STATE and YEAR )

- numproposals - number of proposals made by  party
- didPropose -  logical - whether party made any propoals -dummy variable derived from number of proposals > 0
- didControl - logical - whether party was in sole control of the state for the entire relevant period , derived from (control)
- didRule - logical whether party was in power at the end of the period, while redistricting takes place
- didWinever - party was in control at least once  during the period


State-level measures inherited from controlByWindow()
- partylist, partyseq, partytab, singlecontrol, percentsingle, primary, secondary, tertiary
State-level measures added:
- singlecontrol - dummy, where singlecontrol != NONE
NOTE: these  are measures of the STATE at that time, not specific to party
- partylist - names of parties in control of state over the relevant prior period, names may repeat if party control cycles back and forth
- year_2017 - indicator if year is 2017, based on (year)
- ruleparty - name of party that was in control at last year of period

```{r}
#Code generating needed variables
ys.proposed <- propfull.df %>% group_by(actor,edon,year) %>% summarise(numproposals=sum(PROPOSED,na.rm=TRUE))
#output <- propstrue(proposals.df)
ys.control <- grule.df %>%  controlByWindow(2000,2013)%>%  mutate (edon=edon, year=2013,                                 control=if_else(singlecontrol,primary,"NONE"))
ys.control %<>% bind_rows (grule.df %>%  controlByWindow(2000,2017) %>% mutate(edon=edon, year=2017,                              control=if_else(singlecontrol,primary,"NONE")))
ys.proposed %<>% left_join(ys.control)
rm(ys.control)
ys.proposed %<>% rowwise() %>% mutate(didPropose=(numproposals>0),didControl=(actor==control))
ys.proposed %<>% rowwise() %>% mutate(year_2017 = ifelse(year == 2017, 1, 0))
ys.proposed %<>% rowwise() %>% mutate(ruleparty = tail(partylist,1)) 
ys.proposed %<>% rowwise() %>% mutate(didRule=(actor==ruleparty))
ys.proposed %<>% rowwise() %>% mutate(didWinever=(actor %in% partylist))

ys.proposed %>% ggplot(aes(control,numproposals))+geom_boxplot()+facet_grid(rows=vars(year))


# join with parties
ys.proposed %<>% left_join(parties.df)

```
Strategic Position Categorization

A party in a "strong" position political position in the state, then they are more likely to propose than a party with a less "strong" position.

The decision is a function of several variables such as: party controls the state during the redistricting year, if the party has been the sole ruler over from 1990-2013/17, and if they have ruled a majority of that timer period, if they have ruled at least once during that time period. 

The variables used in the decision tree embody levels of competition in each state. A state controlled by a single party during the period has low levels of political competition, for example. A state with a party which has not won a majority of elections but has won at least once has some degree of power in a competitive state (there are at least two parties competing), as another example. The former has a better "strategic position" than the latter. 

The "Strategic Positions" are defined as follows:
1. Party a) Controls during redistricting year b) has controlled state in all previous observed periods

2. Party a) Controls during redistricting year b) has NOT controlled state in all previously observed periods

3. Party a) DOES NOT control during the redistricting year b) has NOT controlled state in all previously observed periods c) has won a MAJORITY of previous elections in observed time period

4. Party a) DOES NOT control during the redistricting year b) has NOT controlled state in all previously observed periods c) has won a MINORITY of previous elections in observed time period

5.  Party a) DOES NOT control during the redistricting year b) has NOT controlled state in all previously observed periods c) has won NONE of the previous elections during the time period

6. Party a) DOES NOT control during the redistricting year b) has NOT controlled state in all previously observed periods c) has won NONE of the previous elections during the time period d) another party has won ALL previous elections
```{r}

ys.proposed %<>% rowwise() %>% mutate(
    PartyStratPos = case_when(
      didControl == TRUE     ~ 1, # in sole control entire period
      didRule == TRUE        ~ 2, # NOT in sole control, but won last election
      actor == primary       ~ 3, # NOT win last election, but won most elections
      didWinever == TRUE     ~ 4, # NOT won most, but won at least one
      singlecontrol == FALSE ~ 5, # NOT won ever,  but single party does not control
      TRUE ~ 6 # Out party in noncompetitive state  - different party always in control
    )
  )


table(ys.proposed$PartyStratPos)
check.df <- ys.proposed %>% filter(PartyStratPos == 6)
table(check.df$edon)


# now compute for coalitions
coalitions.df <- read_excel("Coaltion Data State Level 2010-2016 (Coalitions and Parties).xlsx")
coalitions.df  %<>% rowwise()   %>% filter(grepl('-',actor)) %>% mutate(coalition=actor)  %>% separate_rows(actor,sep='-')



coalitions.df %<>% left_join(select(ys.proposed,c("actor","edon","year","PartyStratPos"))) %>% group_by(edon,year,coalition) %>% mutate(CoalitionStratPos=min(PartyStratPos)) %>% select(-PartyStratPos)

ys.proposed %<>% left_join(coalitions.df,by=c("actor","edon","year"))

ys.proposed %<>% mutate(StratPos=if_else(is.na(CoalitionStratPos),PartyStratPos,CoalitionStratPos))




#check pattern of proposal entry
xtab.result <- ys.proposed %>% filter(partytype=="minor" || partytype=="major") %>% xtabs(~partytype+year+didPropose+StratPos,.,drop.unused.levels = TRUE)
ftable(xtab.result)

#gt(ftable(xtab.result))

```

```{r}
#CLM model first
clm.mod <- ys.proposed %>% clm(as.ordered(didPropose)~as.ordered(StratPos), data=., HESS=TRUE)
summary(clm.mod)
confint(clm.mod)
exp(coef(clm.mod)[2])
exp(coef(clm.mod)[3]) 
exp(coef(clm.mod)[4])
exp(coef(clm.mod)[5])
exp(coef(clm.mod)[6])

clm.pred <- predict(clm.mod)
summary(clm.pred)

x <- ys.proposed$didPropose - clm.mod$fitted.values
plot(x)

plot(clm.pred$fit)

```

```{r}
#example of ordinal model only, seems to have numerical problems
#strategic position matters. Also independent

model.results <- ys.proposed %>% clmm(as.ordered(didPropose)~as.ordered(StratPos)+(1|actor),., Hess = TRUE)
summary(model.results)
confint(model.results)

plot(model.results$fitted.values, ys.proposed$StratPos)

anova(model.results, clm.mod)

nagelkerke(fit = model.results, null = clm.mod)
#Odds Ratios
exp(coef(model.results)[2])
exp(coef(model.results)[3]) 
exp(coef(model.results)[4])
exp(coef(model.results)[5])
exp(coef(model.results)[6])

y <- ys.proposed$didPropose - model.results$fitted.values

plot(y)
#Bottom horizontal line represents 95% and the top 99% interval.
#Pretty much exact same output from slightly different variations of the cumulative model. I do not think using "polr()" or a monotonic model would be appropriate for our data. Neither accounts for ordinal independent variables and the "ordinal" package can handle ordincal dependent variables if we want to try to predict partytype or StratPos using the data on hand.
```

  #H.1.1.1.a 
#Comparing the decision of the ruling party to formulate a counterproposal to other parties in that same state --> Requires  a dummy capturing if the state had single party dominance (single_pty_dom_00_17:True) --> In those states where the condition is met --> the ruling party is more likely to formulate a counterporposal than each opposition party in that same state. 

#Method: Difference of means test: H1: mean of ENTRY for the Ruling Party in a state with single party dominance > mean of ENTRY for each opposition party in that same state; H0: mean of ENTRY for the Ruling Party in a state with single party dominance <= mean of ENTRY for (each) opposition parties in that same state. 
```{r}

require(broom)
require(GGally)
tabfit <- ys.proposed %>% xtabs(~didPropose+didControl+year,data=.)
print(tabfit)
ftable(tabfit)
ys.proposed %>% ggplot(aes(didControl,didPropose))+geom_col()+facet_grid(rows=vars(year))
glmfit <- ys.proposed %>% glm(didPropose~didControl+year,data=.,family=binomial())
summary(glmfit)
augment(glmfit) %>% ggplot(aes(didPropose,.fitted))+geom_jitter()+facet_grid(rows=vars(didControl))
ggcoef(glmfit)
```

Build Alternation Data Frame
Variables relate to the "competitiveness" of the state (i.e. more alternation = higher levels of competition)

# NEEDS TO BE REWORKED for ys.proposed as df

Some visualizations
```{r}
ys.proposed %>% ggplot(aes(StratPos)) + geom_histogram() +facet_wrap(~year)

ys.proposed %>% filter(partytype == "major" | partytype == "minor" & year == 2013) %>% ggplot(aes(StratPos)) + geom_histogram() + facet_wrap(~actor)
ys.proposed %>% filter(partytype == "major" | partytype == "minor" & year == 2017) %>% ggplot(aes(StratPos)) + geom_histogram() + facet_wrap(~actor)

ys.proposed %>% filter(partytype == "major" | partytype == "minor") %>% ggplot(aes(StratPos)) + geom_histogram() + facet_wrap(~partytype)

ys.proposed %>% ggplot(aes(didPropose)) + geom_bar()
ys.proposed %>% ggplot(aes(didPropose)) + geom_bar() + facet_wrap(~partytype)
ys.proposed %>% ggplot(aes(didPropose)) + geom_bar() + facet_wrap(~StratPos)
```

Models
Decision Tree
```{r}
#Build a train/test sets
index <- sample(1:nrow(ys.proposed))
ys.proposed <- ys.proposed[index,]

create_train_test <- function(data, size=0.7, train=TRUE){
  nrow = nrow(data)
  total_row = size*nrow
  train_samp <- 1:total_row
  if(train==TRUE){
    return(data[train_samp,])
  }else{
    return(data[-train_samp,])
  }
}

train <- create_train_test(ys.proposed, 0.7, train = TRUE)
test <- create_train_test(ys.proposed, 0.7, train = FALSE)
dim(train)
dim(test)
prop.table(table(train$didPropose))
prop.table(table(test$didPropose))

library(rpart)
library(rpart.plot)

DT.1 <- rpart(didPropose ~ actor, data = train, method = "class")
rpart.plot(DT.1, extra=106)
#Its clear that since the data is unbalanced, strategic categorization is unable to beat a theoretic random draw. Rare events and/or ordinal logistic models may better reflect the actual process which we are trying to explain.
```

Logistic Models
```{r}
#1. Logistic
Mod.1 <- ys.proposed %>% filter(partytype == "major") %>% glm(didPropose ~ as.factor(StratPos), data=., family = binomial)
Mod.2 <- ys.proposed %>% glm(didPropose ~  as.factor(partytype), data=., family = binomial)

summary(Mod.1)
summary(Mod.2)
```

Rare Events Model
```{r}
#xtabs(~ys.proposed$didPropose)

#library(Zelig)
#re.mod.1 <- ys.proposed %>% zelig(didPropose ~ as.ordered(StratPos), data = .,model = "relogit", tau = 650/748, case.control = "weighting", bias.correct = TRUE)
#summary(re.mod.1)

#ys.proposed.1 <- ys.proposed %>% filter(partytype == "major")
#xtabs(~ys.proposed.1$didPropose)

#re.mod.2 <- ys.proposed.1 %>% zelig(didPropose ~ as.ordered(StratPos), data = .,model = "relogit", tau = 6/197, case.control = "weighting", bias.correct = TRUE)
#summary(re.mod.2)

#The RE model does not provide any further insight into the causal effects of being the party in control on proposing redistricting plans. The data is unbalanced -- this should have taken care of that issue. The data is also "small" which compounds that issue, but makes it harder to solve (tau, in the model, is still large for a RE model).
```

  #H.1.1.1.b 
#Comparing the decision of the ruling party to formulate a counterproposal to other parties in states that have expereinced alternation in power. --> Requires a categorical variable capturing if degree of ALTERNATION or simply if single_pty_dom_00_17:False. This hypothesis is evaluating if the ruling party is more likely to formulate a counterporposal in states where there is single party rule, than in states where alternation takes place. 
#Method: Difference of means test: H1: mean of ENTRY for the Ruling Party in states with single party dominance > mean of ENTRY for the Ruling Party in states that have experienced alternation; H0: mean of ENTRY for the Ruling Party in states with single party dominance <= mean of ENTRY for the Ruling Party in states that have experienced alternation. 

#H.1.1.2 Parties that are secondary or terciary forces at the state level, are more likely to participte in redistricting (formulate a counterproposal), than all other opposition parties. 

#H.1.1.3 As alternation in power/ competition increases at the state level, we expect to observe a higher number of counterporposals.
  #H.1.1.3.a number of proposals by single party control.
  
  #H.1.1.3.b number of proposals by degree of alternation

#1.1.1.4 Ruling parties in states with the highest level of alternation in power, are more likely to participte in redistricting (formulate a counterproposal), than all other opposition parties.

//////////////////////////////////////////////////////////////////////////////////////////
H1.2: Strategic Decision (Party deciides how to play the game based on the Ruling Party at the state level) --> Decision of a political party to participate in redistricting based on degree of alternatioin at the state level.
//////////////////////////////////////////////////////////////////////////////////////////

Hypotheses (stage --> First vs Second Round):
 
#H.1.2.1 Parties are more likely to participate in redistricting (formulate a counterproposal) during the first round. --> 

#THEORY:The theory behind this hypothesis is that, ceteris paribus, is that parties are more likely to play the game (propose) during the first stage becasue of the first mover advantage (if your counter proposal is selected in the first round it becomes the departing point for the second round) --> We assume that the margin of change from the first to the second scenario is larger than the margin of change between the second and third scenario (this assumption can be tested with Cox and Katz's difference similarity index). 

#DIAGNOSTICS: a) Breakdown of proposals made in the first vs second stage in 2013 and 2014; b) Breakdown of proposals made in the first vs second stage by party in 2013 and 2014; and c) Breakdown of proposals made in the first vs second stage by state in 2013 and 2014; b) Breakdown of proposals made in the first vs second stage by party and state in 2013 and 2014. 

=====

#H.1.2.2 Parties ruling a state under single party dominance, are more likely to participate in redistricting (formulate a counterproposal) during the first round, than all other opposition parties. 

#THEORY:The theory behind this hypothesis is that, ceteris paribus, dominant parties have more vested interests and will be more likely to engage in the first state than smaller and non-competitive parties. 

#DIAGNOSTICS: a) Breakdown of proposals made in the first vs second stage in 2013 and 2014 controling for strategic position and major vs minor parties;

====

#H.1.2.3 Parties that are secondary or terciary forces at the state level, are more likely to participate in redistricting (formulate a counterproposal) during the first round, than smaller opposition parties.

#THEORY: The theory behind this hypothesis is that, ceteris paribus, parties that are competing for power are more likely to engage in the first state than smaller and non-competitive parties. 

#DIAGNOSTICS: a) Breakdown of proposals made in the first vs second stage in 2013 and 2014 controling for strategic position and major vs minor parties;

===

#1.2.4 As alternation in power/competition increases at the state level, the number of counterporposals in the second stage will be higher compared to states dominated by a single party.

#THEORY:The theory behind this hypothesis is that, ceteris paribus, as competition increases, parties that are competing for power are more likely to engage in the process in the second stage. 

#DIAGNOSTICS: a) Breakdown of proposals made in the first vs second stage in 2013 and 2014 controling for strategic position and major vs minor parties;

Hypotheses (level --> CLV (Local) vs CNV(National):

#H.1.2.5 (centralization/coordination hypothesis) We would expect the CNV to have the upper hand and formulate more proposals in both processes. 

#THEORY:Despite parties can engage both at the local and national level, the redistricting process and the TC session in the main headquarters, which is where the CNV is based. Furthermore, the CNV has a more direct connection with the parties' headquarters in Mexico City (CEN). 

#DIAGNOSTICS: a) Breakdown of proposals mad in the CNV and CLV. 

#H.1.2.6 (Novelty/Learning to play the game) We expect more proposals by the CNV in 2013 than in 2017. 

#THEORY: We expect that given that online interaction was new in 2013, the CNV would be more proactive that year. 
#DIAGNOSTICS: a) Breakdown of proposals mad in the CNV and CLV in 2013 and 2017. 

#H.1.2.7 As alternation in power/competition increases at the state level, parties are more likely to formulate a counterproposal at the local level (CLV)

#THEORY:The theory behind this hypothesis is that  the national headquarters of a party (CNV) are going to be more interested in engaging in those state where the party has a stronghold or is competitive. As competition increases across states, we expect to see smaller parties engaging more at the local level (CLV)

#DIAGNOSTICS: a) Breakdown of proposals made in the CNV vs CLV in 2013 and 2014 controling for strategic position and major vs minor parties;

Hypotheses (Process --> 2013 vs 2017):

#H.1.2.8 We expect to observe more proposals in 2013 than in 2017

#THEORY: Parties are more likely to formulate a counterproposal in because the two levels were more proactive 2013, less precise, and the algorithm was less efficent (allowed greater margin of change). 

#DIAGNOSTICS: a) Breakdown of proposals made in 2013 and 2014

//////////////////////////////////////////////////////////////////////////////////////////
H3: Coalitions
//////////////////////////////////////////////////////////////////////////////////////////

//////////////////////////////////////////////////////////////////////////////////////////
H3.1: Coaltions (Stong and Succesful Coaltion)--> Comparing interaction based on the desission to build state level coalitions.  
//////////////////////////////////////////////////////////////////////////////////////////
Hypothesis
#3.1.1 Smaller Parties (not PRI, PAN or PRD) are more likely to engage if they are running in a coalition than if they are competing alone.  

#THEORY: Smaller parties have more at stake when they are running with a larger party. 

#DIAGNOSTICS: a) Breakdown of proposals made by smaller parties in coalition and smaller parties racing alone. 

Data Exploration
MINOR PARTIES
```{r}
SP.df <- ys.proposed %>% filter(partytype == "minor") %>% mutate(incoalition = ifelse(extension > 0, 1, 0))
SP.df %>% ggplot(aes(didPropose)) + geom_bar() +facet_grid(rows = vars(incoalition), cols = vars(year))
SP.df %>% ggplot(aes(StratPos)) + geom_bar() +facet_wrap(~incoalition)
SP.df %>% filter(incoalition == 1) %>% ggplot(aes(coalition)) + geom_bar() + theme(axis.text.x = element_text(angle = 90))
```


#3.1.2 Larger Parties (PRI, PAN or PRD) not ruling the state are more likely to engage in the process via a coaliton.  

#THEORY: Larger parties will try to engage the process by making a coalition with smaller parties.  

#DIAGNOSTICS: a) Breakdown of proposals made by non-ruling larger parties in coalition vs non-rulling larger parties racing alone in 2013 and 2017.

MAJOR PARTIES
```{r}
LP.df <- ys.proposed %>% filter(partytype == "major" & singlecontrol == didControl) %>% mutate(incoalition = ifelse(extension > 0, 1, 0))
LP.df %>% ggplot(aes(didPropose)) + geom_bar() +facet_grid(rows = vars(incoalition), cols = vars(year))
LP.df %>% ggplot(aes(StratPos)) + geom_bar() +facet_wrap(~incoalition)
```

Variables
#DV: Dummy variable capturing if party formulated a proposal (PROPOSED: True or False, by Sate, by round, by year).
#IV(1): Dummy variable captruing if a party competed under a coalition before redisrticting took place. 

#3.1.3 (Extension and competitiveness) #Smaller parties (not PRI, PAN or PRD) that have a strong and successful coalition with a larger party, are more likely  to formulate a similar counter proposal to its larger coalition mate than smaller parties that competed separately.  

#THEORY: As the coalitions extension and stength increases, parties in the coalition are more likely to engage. 

#DIAGNOSTICS: a) Breakdown of proposals made by parties proposing in coalition based on the level of high extension and competitivness(DUMMY WHERE E>.5 AND C>.5 = 1, Otherwise 0). 

#3.1.3 (Check Matching Proposals): If parties are run in coalition, we expect that they will have matching scores in proposals. 

#THEORY Parties competing together in a coalition should formulate the same plan. 
Matching Process (Practice)
```{r}
matching.df <- propfull.df %>% left_join(coalitions.df, by=c("edon", "year", "actor"))

matching.df.1 <- matching.df %>% filter(year == 2013 & govlevel == "CNV" & Entidad == "Baja California" & SCORE > 0) %>% mutate(compSCORE = case_when(coalition == "PAN-PRD-PNA" ~ SCORE))
matching.df.1 %<>% fill(compSCORE)
matching.df.1$samePlan <- 0
matching.df.1[matching.df.1$SCORE == matching.df.1$compSCORE,]$samePlan <- 1

#separate_rows() tidy function, creats row copies
#group by state, year, coalition
#Scores are all equal if propsoal score is equal for all members w/ same 
```

#DIAGNOSTICS: a) Breakdown of proposals matching scores when parties ran in coalition (create a dummy)


//////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////
STOP READING HERE (Below: Departing ideas for conversation 01/14/20)
//////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////


//////////////////////////////////////////////////////////////////////////////////////////
H1: Ruling Party (Single Party Dominance/Alternation)
//////////////////////////////////////////////////////////////////////////////////////////

//////////////////////////////////////////////////////////////////////////////////////////
H1.1: Single Party Dominance (dominant party) --> Comparing dominant parties vs opposition parties in states ruled by a single party
//////////////////////////////////////////////////////////////////////////////////////////
Hypothesis:
# If a state is dominated by a single party prior the redistricting process, the ruling party in that state is more likely to formulate a counterproposal than any other party. 

Variables: 
#DV: Dummy variable capturing if party formulated a proposal (PROPOSED: True or False, by Sate, by round, by year).

#IV(1): Dummy variable captruing if a single party ruled that state before redisrticting took place (single_pty_dom_00_17:True or False, by State). 

#IV(2): Categorical variable captruing the degree of alternation in power (six categories from a non-competitive state to a party that has multiparty comptetion and alternation has taken place >3+ times in the 00-17 period): 1) single_pty_dom_00_17:True or False, by State; 2) alt_power1_00_17; 3) alt_power2_00_17; 4) alt_power2_00_17 x multi_comp_00_17; 5) alt_power3_00_17; 6) alt_power3_00_17 x multi_comp_00_17. 

Method:
#To test H1.1: chi.sq test.

#Comparing parties:If the hypothesis is true, we would expect that the dominating party in states ruled by a single party, is more likely to formulate a counterporposal than opposition parties (this hypothesis can be tested by stage and/or combining both stages 1 and 2).

//////////////////////////////////////////////////////////////////////////////////////////
H1.2: Alternation in Power (opposition party(ies)) --> Comparing opposition parties in states with alternation vs opposition parties in states ruled by a single party
//////////////////////////////////////////////////////////////////////////////////////////
Hypotheses:
# If a state has gone through alternation in power, the main oppoition party (secondary force) is as likely to formulate a counterporposal as the ruling party.

# If a state has gone through alternation in power, oppoition parties are as likely to formulate a counterporposal as the ruling party.

Variables: 
#DV: Dummy variable capturing if party formulated a proposal (PROPOSED: True or False, by Sate, by round, by year).

#IV(1): Dummy variable captruing if a single party ruled that state before redisrticting took place (single_pty_dom_00_17:True or False, by State). 

#IV(2): Categorical variable captruing the degree of alternation in power (six categories from a non-competitive state to a party that has multiparty comptetion and alternation has taken place >3+ times in the 00-17 period): 1) single_pty_dom_00_17:True or False, by State; 2) alt_power1_00_17; 3) alt_power2_00_17; 4) alt_power2_00_17 x multi_comp_00_17; 5) alt_power3_00_17; 6) alt_power3_00_17 x multi_comp_00_17. 

Method: 
#To test H1.1: chi.sq test.

#Comparing parties: In states that have experienced alternation in power, we expect the main opposition parties to be as likely as the dominating party to formulate a counterproposal. We expect a stronger effect as multiparty competition and alternation in power increase (this hypothesis can be tested by stage and/or combining both stages 1 and 2).

//////////////////////////////////////////////////////////////////////////////////////////
H1.3: Alternation in Power (alternation and multiparty competition) --> Comparing the total number of counterporposals at the state level as alternation and multiparty competition increase. 
//////////////////////////////////////////////////////////////////////////////////////////
Hypothesis:
# Paries in states with alternetion and multipary competition are more likely to formulate a higher number of counterproposals being formulated than prties in states that are dominated by a single party. 

or 

#As alternation and multipartycompetition incease, more proposals will be formulated.
 
Variables: 
#DV: Total number of counterproposals formulated. Based on the dummy variable capturing if party formulated a proposal (PROPOSED: True or False, by Sate, by round, by year).

#IV(1): Dummy variable captruing if a single party ruled that state before redisrticting took place (single_pty_dom_00_17:True or False, by State). 

#IV(2): Categorical variable captruing the degree of alternation in power (six categories from a non-competitive state to a party that has multiparty comptetion and alternation has taken place >3+ times in the 00-17 period): 1) single_pty_dom_00_17:True or False, by State; 2) alt_power1_00_17; 3) alt_power2_00_17; 4) alt_power2_00_17 x multi_comp_00_17; 5) alt_power3_00_17; 6) alt_power3_00_17 x multi_comp_00_17. 

Method: 
#To test H1.1: chi.sq test.

# If the hpothesis is true, we would expect to observe more counterporposals in states with more alternation and multiparty competition.


//////////////////////////////////////////////////////////////////////////////////////////
H2:Party Strenght (Vote Returns) 
//////////////////////////////////////////////////////////////////////////////////////////

//////////////////////////////////////////////////////////////////////////////////////////
H2.1: Party Strenght (High vs Low vote returns at the seccion level)--> Comparing interaction under different levels of electoral returns 
//////////////////////////////////////////////////////////////////////////////////////////
Hypothesis
# If a party receives a high vote share in a state, it is more likely to formulate a counterproposal than those parties that receive a lower vote share.

Variables: 
#DV: Dummy variable capturing if party formulated a proposal (PROPOSED: True or False, by Sate, by round, by year).

#IV(1): Dummy variable captruing if a party has high or low levels of vote returns in a particular state before redisrticting took place (High > 50%, Low <24%). 

#IV(2): Categorical variable capturing the level of vote returns (Five categories: Very High(>75%), High(74%-50%), Medium (49%-25%), Low (24%-15%), Very Low (<14%). 

#IV(3): Continous variable capturing the vote share received by each party at the state level (0-100).

Method:
#To test H2.1: Chisq and Difference of means.

//////////////////////////////////////////////////////////////////////////////////////////
H2.2: Party Competion (High vs Low levels of electoral competition)--> Comparing Interaction under different levels of competition 
//////////////////////////////////////////////////////////////////////////////////////////
Hypotheses
# As competitiveness increases at the state level (e.g., ratio of safe vs competitive districts), we can expect to observe a higher number of counterproposals.

and/or 

# As competitiveness increases (e.g., ratio of safe vs competitive districts), opposition parties are as likely to formulate a conterproposal as the ruling party. 

and/or 

# In a safe state, the ruling party is more likely to formulate a counterproposal than any other party.

and/or

# In a safe state, the main opposition party (secondary force) is as likely a formulate a counterproposal than the ruling party.

Variables: 
#DV: Dummy variable capturing if party formulated a proposal (PROPOSED: True or False, by Sate, by round, by year).

#IV(1): Dummy variable captruing if a state con be considered competitive or safe (High > 50%, Low <24%). 

#IV(2): Categorical variable capturing the level of district competitiveness at the state level (Five categories: Very High(>75%), High(74%-50%), Medium (49%-25%), Low (24%-15%), Very Low (<14%). 

#IV(3): Continous variable capturing the level of competitiveness in each district at the state level (0-100).

Method:
#To test H2.2: Chisq and Difference of means.


//////////////////////////////////////////////////////////////////////////////////////////
H2.3: Party Strongholds --> Comparing Interaction assuming parties want to protect strongholds 
//////////////////////////////////////////////////////////////////////////////////////////
Hypothesis
# ???? (Still working on this one). It seems this would be district or municipal level analysis to see if parties are protecting strongholds, but not at the entry/state level. 

Variables: 
#DV: Dummy variable capturing if party formulated a proposal (PROPOSED: True or False, by Sate, by round, by year).

#IV(1): Dummy variable captruing if a party has high or low levels in a particular state before redisrticting took place (single_pty_dom_00_17:True or False, by State). 

#IV(2): Categorical variable capturing the level of vote returns (Five categories: Very High(>75%), High(74%-50%), Medium (49%-25%), Low (24%-15%), Very Low (<14%). 

Method:
#To test H2.3: Difference of means.

#Comparing parties:.



//////////////////////////////////////////////////////////////////////////////////////////
H3: Coalitions
//////////////////////////////////////////////////////////////////////////////////////////

//////////////////////////////////////////////////////////////////////////////////////////
H3.1: Coaltions (Stong and Succesful Coaltion)--> Comparing interaction based on the desission to build state level coalitions.  
//////////////////////////////////////////////////////////////////////////////////////////
Hypothesis
#Smaller parties (not PRI, PAN or PRD) that have a strong and successful coalition with a larger party, are more likely  to formulate a similar counterproposal to its larger coalition mate than smaller parties that competed separately. 

Variables: 
#DV: Dummy variable capturing if party formulated a proposal (PROPOSED: True or False, by Sate, by round, by year).

#IV(1): Dummy variable captruing if a party competed under a coalition before redisrticting took place. 

#IV(2): Dummy variable captruing if a coalition was strong and successful before redisrticting took place. 

Method:
#To test H3.1: Chisq test.

#Comparing parties:.


//////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////
STOP READING HERE
//////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////


#Work in Progress 

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////
Code
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////