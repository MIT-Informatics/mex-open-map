---
title: "R Notebook"
output: html_notebook
---

```{r}
library(haven)
library(tidyr)
library(readr)
library(dplyr)
library(magrittr)

RulingParty <- read_dta("RulingPartyLong.dta")
grule.df <- as_tibble(RulingParty) %>% group_by(state)

controlByWindow<-function(.data,start,end) {
  tmp <- .data %>% filter(year >=start & year < end)  %>% arrange(year) %>% summarise(partylist=list(party)) %>% rowwise()
  tmp %<>%  mutate(partyseq=list(rle(as.character(partylist))),partytab=list(sort(table(as.character(partylist)),decreasing=TRUE)))
  tmp  %<>% mutate( singlecontrol = (length(partytab)==1), primary=names(partytab)[1], percentsingle=partytab[1]/sum(partytab), naltpower=(length(partyseq[["values"]])-1))
  tmp %<>% ungroup()
  return(tmp)
}
```


```{r}
mydummies9413.df <- grule.df %>%  controlByWindow(1994,2013)

```



